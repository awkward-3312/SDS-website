<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin - Gesti√≥n de Productos</title>

  <link rel="stylesheet" href="admin.css">
  <script type="module" defer src="admin.js"></script>
</head>

<body>

  <!-- Topbar simple (reemplaza la sidebar) -->
  <header class="topbar main-topbar" role="banner" aria-label="Barra superior">
    <div class="topbar-left">
      <h1>Productos</h1>
      <div class="meta">Panel Administrativo</div>
    </div>

    <!-- Area de sesi√≥n / toggles -->
    <div class="topbar-right" id="auth-area" aria-live="polite">
      <div class="view-toggles" role="toolbar" aria-label="Controles de vista" style="display:flex;gap:8px;align-items:center">
        <button id="toggle-compact" class="btn-ghost" aria-pressed="false" title="Modo compacto" type="button">Compacto</button>
        <button id="toggle-table" class="btn-ghost" aria-pressed="false" title="Vista tabla" type="button">Tabla</button>
      </div>
      <!-- admin.js rellenar√° info de sesi√≥n aqu√≠ -->
    </div>
  </header>

  <main class="main main-full" id="main-content" role="main">
    <section class="page-lede" aria-label="Resumen de la p√°gina">
      <div class="lede-title">Control r√°pido de inventario</div>
      <p class="lede-text">Busca, filtra y cambia de vista sin perder de vista el contexto. Mant√©n tus productos al d√≠a con acciones claras.</p>
    </section>

    <section class="controls" aria-label="Controles de productos">
      <div class="left-controls">
        <button id="refresh" class="btn" type="button">Refrescar</button>
        <button id="new-product" class="btn primary" type="button">+ Nuevo producto</button>
      </div>

      <div class="right-controls">
        <input id="search" type="search" placeholder="Buscar por t√≠tulo, sku..." aria-label="Buscar productos" />
        <select id="filter-category" aria-label="Filtrar por categor√≠a">
          <option value="">Todas las categor√≠as</option>
        </select>
      </div>
    </section>

    <section class="helper-banner" aria-label="Sugerencia de uso">
      <div class="helper-badge" aria-hidden="true">Tip</div>
      <div class="helper-copy">
        <p class="helper-title">Usa las vistas para trabajar mejor</p>
        <p class="helper-text">Activa el modo compacto o de tabla desde la barra superior cuando necesites revisar muchos productos a la vez.</p>
      </div>
    </section>

    <section id="product-list" class="product-list" aria-label="Listado de productos">
      <div class="empty-state" role="status">
        <div class="empty-icon" aria-hidden="true">üì¶</div>
        <div>
          <div class="empty-title">No hay productos</div>
          <p class="empty-text">Pulsa "Refrescar" para sincronizar o crea un art√≠culo nuevo desde el bot√≥n superior.</p>
        </div>
      </div>
    </section>

    <footer class="footer" role="contentinfo">
      <small>Panel Admin ‚Äî Warehouse</small>
    </footer>
  </main>

  <!-- Modal / Drawer para crear/editar producto -->
  <div id="modal" class="modal" hidden role="dialog" aria-labelledby="modal-title" aria-modal="false">
    <div class="modal-panel" role="document">
      <header class="modal-header">
        <h2 id="modal-title">Nuevo producto</h2>
        <button id="modal-close" class="btn-ghost" type="button" aria-label="Cerrar">‚úï</button>
      </header>

      <form id="product-form" class="modal-form" novalidate>
        <input type="hidden" name="id" id="product-id">

        <div class="form-row">
          <label for="title">T√≠tulo *</label>
          <input id="title" name="title" type="text" required placeholder="Camisa blanca" autocomplete="off">
        </div>

        <div class="form-row two-col">
          <div>
            <label for="sku">SKU</label>
            <input id="sku" name="sku" type="text" placeholder="CAMISA-001" autocomplete="off">
          </div>
          <div>
            <label for="category">Categor√≠a</label>
            <input id="category" name="category" type="text" placeholder="Ropa / Hombres" autocomplete="on">
          </div>
        </div>

        <div class="form-row">
          <label for="description">Descripci√≥n</label>
          <textarea id="description" name="description" rows="3" placeholder="Descripci√≥n breve"></textarea>
        </div>

        <div class="form-row two-col">
          <div>
            <label for="price">Precio *</label>
            <input id="price" name="price" type="number" min="0" step="0.01" required placeholder="0.00" autocomplete="off">
          </div>
          <div>
            <label for="stock">Stock *</label>
            <input id="stock" name="stock" type="number" min="0" required placeholder="0" autocomplete="off">
          </div>
        </div>

        <!-- ---------- Uploader mejorado (visual + accesible) ---------- -->
        <fieldset class="uploader" aria-label="Uploader de imagen principal">
          <legend>Imagen principal</legend>

          <div class="form-row">
            <label for="image-name">Nombre del archivo (editable)</label>
            <input id="image-name" name="image_name" type="text" placeholder="camisa-blanca.png" aria-label="Nombre del archivo (editable)" autocomplete="off">
          </div>

          <div id="uploader-dropzone" class="uploader-dropzone" role="button" tabindex="0" aria-label="Seleccionar o arrastrar imagen">
            <div class="uploader-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="48" height="48" aria-hidden="true">
                <path d="M7 10V9C7 6.23858 9.23858 4 12 4 14.7614 4 17 6.23858 17 9V10" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 12V21" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M9 15L12 12L15 15" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>

            <div class="uploader-info">
              <div class="muted" style="margin-bottom:8px;">JPG, PNG, WEBP ‚Äî m√°ximo 5MB. Arrastra o haz click.</div>

              <div class="preview-row" style="align-items:center;gap:12px">
                <div class="preview" style="width:160px;height:110px;">
                  <img id="img-preview" alt="Preview" src="" hidden>
                  <div id="preview-placeholder" class="muted">No hay imagen seleccionada</div>
                </div>

                <div class="uploader-controls" style="flex:1;display:flex;flex-direction:column;gap:8px">
                  <div id="upload-status" class="muted">Estado: idle</div>
                  <div id="upload-error" class="error" hidden></div>
                  <div id="upload-success" class="success" hidden></div>

                  <div class="uploader-actions">
                    <button id="auto-name" type="button" class="btn-ghost">Sugerir nombre</button>
                    <button id="start-upload" type="button" class="btn primary">Subir imagen</button>
                  </div>
                </div>
              </div>
            </div>

            <input id="image-file" name="image_file" type="file" accept="image/png,image/jpeg,image/webp" hidden>
          </div>
        </fieldset>

        <div class="form-row">
          <label for="image-filename">Nombre archivo (lectura)</label>
          <input id="image-filename" name="image_filename" type="text" readonly placeholder="camisa-blanca.png">
        </div>

        <div class="form-row">
          <label for="image-path">Ruta de almacenamiento (lectura)</label>
          <input id="image-path" name="image_path" type="text" readonly placeholder="products/CAMISA-001/camisa-blanca.png">
        </div>

        <div class="form-actions">
          <button id="save-product" type="submit" class="btn primary">Guardar</button>
          <button id="cancel" type="button" class="btn-ghost">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <div id="modal-overlay" class="modal-overlay" hidden></div>
  <div id="toast-root" aria-live="polite" class="toast-root" role="status"></div>

  <script type="module" src="admin.js?v=authfix-1"></script>

</body>
</html>
